# 設計書: IPCリファクタリング動作検証

## 1. 最終目的

クライアント/サーバー間のIPC（プロセス間通信）が、`docs/ARCHITECTURE_GUIDE.md`に記載された最終仕様通りに、堅牢かつ正確に動作することを実証する。

## 2. システムアーキテクチャ

- **クライアント (`simple_continuous_executor.py`):** Pythonスクリプト。リクエストJSONファイルを`requests`ディレクトリに配置する責務のみを持つ。リトライやレスポンス待ちは行わない。
- **サーバー (VSCode Extension - `IPCRequestHandler.ts`):** `requests`ディレクトリを監視。リクエストを受信すると最大2回（初回+リトライ1回）の処理を試行し、全試行結果を含む単一のレスポンスファイルを`responses`ディレクトリに書き込む。最終的に失敗した場合は、そのレスポンスファイルを`failed`ディレクトリにコピーする。処理完了後、元のリクエストファイルは必ず削除する。
- **通信媒体:** ファイルシステム (`/tmp/copilot-evaluation/`)

## 3. ファイル構造

```
/tmp/copilot-evaluation/
├── requests/      # クライアントがリクエストJSONを配置
├── responses/     # サーバーがレスポンスJSONを配置
└── failed/        # サーバーが失敗したレスポンスJSONをコピー
```

## 4. 実行計画 (ステップバイステップ)

- [ ] ステップ1: テスト環境のクリーンアップ（`requests`, `responses`, `failed`ディレクトリを空にする）。
- [ ] ステップ2: クライアント(`simple_continuous_executor.py`)を実行し、単一のリクエストを送信する。
- [ ] ステップ3: ファイルシステムの最終状態を観測する。
- [ ] ステップ4: 観測結果がアーキテクチャの期待値と一致することを検証し、最終報告書を作成する。

## 5. 検証項目（期待される最終状態）

- `requests`ディレクトリは空であること。
- `responses`ディレクトリに、処理結果（成功または失敗）を示すレスポンスファイルが1つ存在すること。
- 処理が失敗した場合のみ、`failed`ディレクトリに`responses`ディレクトリと同一のファイルがコピーされていること。
- 処理が成功した場合は、`failed`ディレクトリは空であること。
