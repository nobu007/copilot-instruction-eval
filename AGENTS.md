# CLAUDE.md/AGENTS.md - AI 自動化指示書

## 🎯 AI作業者への最優先指示

### 📋 TASKS.md 自律的タスク管理システム

**⚠️ 重要：全ての作業開始前に必ずTASKS.mdを確認・更新してください**

#### **自律的作業フロー**

1. **作業開始時**：`docs/TASKS.md`を読み込み、最終ゴール・直近ゴール・タスク一覧を確認
2. **作業中**：進捗をTASKS.mdに随時更新（完了管理・ユーザフィードバック記録）
3. **作業完了時**：結果をTASKS.mdに記録し、次のタスクを特定

#### **TASKS.md必須内容**

```markdown
## 🎯 最終ゴール(1件)
[プロジェクト全体の達成目標]

## 🎭 ゴールまでのマイルストーン(最大10件)
[ゴールまでに実現するべき状況を優先度順に記載]

## 🎭 直近のゴール(1件)
[現在フォーカスしている短期目標]

## 📋 タスク一覧(直近5件のみ残す)
- [ ] タスク1（優先度：高・中・低）
- [x] 完了タスク（完了日時記録）

## 💬 ユーザフィードバック履歴(直近5件のみ残す)
[ユーザからの指示・要望・フィードバックを時系列で記録]
```

#### **自律的判断原則**

- TASKS.mdの内容に基づいて**自動的に次の作業を決定**
- ユーザからの明示的指示がない場合は、TASKS.mdの優先度順で作業継続
- 疑問・判断に迷う場合のみユーザに確認

#### **詳細記録の自律的管理**

- **全ての作業終了時にTASKS.mdを詳細更新**（F-2原則適用）
- **エラー発生時は即座に詳細記録**（再現可能な形で）
- **手動作業が発生した場合は根本原因分析・自動化修正計画を記録**
- **次回作業者が即座に作業継続可能な粒度で記録**

---

## 🌐 システム全体での位置付け

このファイルは **UCG DevOps** リポジトリ専用の AI 指示書です。

### 📋 全体システム理解のために

- **システム全体概要**: `docs/SYSTEM_OVERVIEW.md` を先に参照してください
- **ワークフロー構造化原則**: `docs/WORKFLOW_ARCHITECTURE.md` でGitHubワークフローの設計原則を確認
- **マルチエージェント協調**: 他のエージェントとの連携方法を理解できます
- **役割分担**: このリポジトリの責任範囲と他との関係を把握できます

### 📂 プロジェクト構成とファイル配置指示

#### **⚠️ 重要：ファイル配置の絶対ルール**

**ルートディレクトリには以下3つのファイルのみ許可：**

```txt
copilot-instruction-eval/
├── AGENTS.md          # AI自動化指示書（このファイル）
├── CLAUDE.md          # AGENTS.mdへのシンボリックリンク
└── README.md          # プロジェクトメインドキュメント
```

**⛔ ルートディレクトリ配置禁止：**

- テストレポート系（TEST_RESULTS_*.md等）
- 分析レポート系（ISSUE_ANALYSIS.md、SYSTEM_ANALYSIS.md等）
- 計画・戦略系（TEST_PLAN.md、IMPROVEMENT_ROADMAP.md等）
- その他一時的なドキュメント

#### **docsディレクトリ** (体系的なドキュメント管理)

**メインドキュメント：**

```txt
docs/
├── TASKS.md                   # AI自律的タスク管理（最優先）
├── SYSTEM_OVERVIEW.md         # システム全体概要
├── WORKFLOW_ARCHITECTURE.md   # GitHubワークフロー構造化原則
├── TESTING_PLAN.md           # 実用テスト実行計画
├── TEST_STRATEGY.md          # テスト戦略定義
├── COMPREHENSIVE_TEST_PLAN.md # 包括テスト詳細仕様
├── DEVELOPMENT.md            # 開発ガイド
├── IMPROVEMENT_ROADMAP.md    # 改善ロードマップ
├── TEST_RESULTS_SUMMARY.md   # テスト結果サマリー
└── [動的生成ドキュメント]     # 新規作成されるドキュメント
```

**アーカイブ（開発過程の記録保存）：**

```txt
docs/archive/
├── ISSUE_ANALYSIS.md         # 問題分析レポート
├── FIX_PROPOSALS.md          # 修正提案レポート
├── SYSTEM_ANALYSIS.md        # システム分析レポート
├── NEXT_TEST_PLAN.md         # 次期テスト計画
├── FINAL_TEST_REPORT.md      # 最終テストレポート
├── TEST_PLAN.md              # テスト計画
└── [履歴・バックアップ]       # 過去バージョンやバックアップ
```

#### **機能ディレクトリ** (実装・設定・テスト)

```txt
config/               # 本番設定ファイル
test-config/          # テスト専用設定
scripts/              # 実行スクリプト
tests/                # テストスクリプト
templates/            # テンプレートファイル
logs/                 # ログファイル
```

#### **🎯 新規ファイル作成時の配置判断基準**

| ファイル種別 | 配置場所 | 例 |
|-------------|----------|-----|
| **システム説明・手順書** | `docs/` | README系、GUIDE系、OVERVIEW系 |
| **テスト結果・レポート** | `docs/` | TEST_RESULTS_*.md、REPORT_*.md |
| **分析・提案書** | `docs/archive/` | ANALYSIS_*.md、PROPOSAL_*.md |
| **一時的・実験的ドキュメント** | `docs/archive/` | 実験結果、一時メモ |
| **設定ファイル** | `config/` または `test-config/` | *.yaml、*.json、*.conf |
| **実行スクリプト** | `scripts/` | *.sh、*.py実行系 |
| **テストスクリプト** | `tests/` | *_test.*、test_*.* |

#### **🚨 AI作業者への厳格指示**

1. **ファイル作成前に必ず上記基準を確認**
2. **ルートディレクトリには絶対に新規ファイルを作成しない**
3. **迷った場合は`docs/`または`docs/archive/`を選択**
4. **作業完了時に必ずファイル配置の整合性を確認**

### ⚠️ 作業優先順位とドキュメント参照

1. **`docs/TASKS.md`でタスク確認・更新** ← 最優先（自律的作業管理）
2. **このファイル（AGENTS.md）の指示** ← コーディング原則・設計ガイド
3. `docs/SYSTEM_OVERVIEW.md` の参考情報
4. `docs/TESTING_PLAN.md` でテスト実行方法確認
5. `docs/archive/` の開発履歴（参考のみ）

## 🤖 このファイルの目的

このファイルは Claude（AI）が**UCG DevOps システム**を自動構築するための詳細指示書です。
人間の介入を最小限に抑え、効率的で確実な自動化を実現します。

## ⚠️ AI実行者への絶対遵守事項

### 🧠 ソフトウェア開発基本原理（最優先）

**全ての作業において以下の基本原理を厳格に遵守：**

#### **A. ゴール逆算思考プロセス（必須）**

```
1. 最終ゴール明確化 → 2. 現状ギャップ分析 → 3. 最適解決策立案 → 4. 実装・検証
```

#### **B. ソフトウェア開発4大原則**

1. **DRY (Don't Repeat Yourself)**: 重複排除・共通化優先
2. **YAGNI (You Aren't Gonna Need It)**: 過剰設計回避・必要最小限実装
3. **KISS (Keep It Simple, Stupid)**: シンプル設計・複雑性回避
4. **Single Responsibility**: 単一責任・機能分離

#### **C. 自動化優先の鉄則**

- ❌ **手動作業は原則禁止** (緊急時除く)
- ✅ **スクリプト・自動化ツール優先**
- ✅ **エラー時は根本原因解決→自動化修正**

### 🔍 クリティカルシンキング必須プロセス

**全てのタスク開始前に以下を実行：**

#### **段階1: ゴール逆算分析**

1. **最終ゴール**: 何を達成すべきか？
2. **成功基準**: どの状態が成功か？
3. **現状分析**: 何が不足・問題か？
4. **ギャップ特定**: 現状→目標への最短経路は？

#### **段階2: 解決策評価**

1. **複数案検討**: 最低3つの解決アプローチを比較
2. **リスク評価**: 各案の失敗リスク・副作用は？
3. **効率性評価**: 工数・時間・保守性の観点で最適か？
4. **自動化可能性**: 将来的な自動化・再利用は可能か？

#### **段階3: 実装前検証**

1. **依存関係確認**: 他システム・ファイルへの影響は？
2. **テスト戦略**: 検証方法・失敗時の復旧手順は？
3. **品質基準**: コーディング原則・セキュリティ要件に適合か？

### 🚨 緊急時判断基準

**エラー・障害発生時の対応優先順位：**

1. **根本原因分析**: なぜ発生したか？（症状治療は禁止）
2. **自動化修正**: スクリプト・設定の修正で解決
3. **手動対応**: 最後の手段（必ず後で自動化）

**場当たり的修正の絶対禁止：**

- ❌ エラーが出たからとりあえず修正
- ❌ 動けばよいという一時的な対応
- ❌ 手動作業で一時的に回避
- ✅ 根本原因解決→自動化→品質向上のサイクル

---

### 🔄 F. 原則更新・改善プロセス

#### **F-1. 原則改善の必須プロセス**

**ケース1: 原則に該当しない判断が必要な場合**

1. 作業を一時停止
2. 「原則更新タスク」をTodoListに追加（最高優先度）
3. 原則を更新してから作業を再開

**ケース2: 原則間の矛盾を発見した場合**

1. 矛盾する原則を特定・文書化
2. より適切な統一原則を提案
3. 全ての関連コードへの影響を評価
4. 原則を更新し、関連コードを一括修正

#### **F-2. 詳細作業記録の必須原則**

**全ての作業は以下の粒度で記録必須:**

1. **修正対象**: ファイルパス・関数名・行番号を明記
2. **具体的変更内容**: 変更前後の差分・追加機能の詳細
3. **エラー詳細**: エラーメッセージ・発生条件・根本原因
4. **未解決問題**: 具体的な症状・再現手順・修正方針
5. **次回作業手順**: 実行可能な具体的ステップリスト

**記録テンプレート:**

```markdown
**修正ファイル**: `path/to/file.sh` line XX-YY
**変更内容**: 関数名change_function()にZZ機能追加
**エラー内容**: "command not found: function_name" at line XX
**根本原因**: 依存関数function_name()が未定義
**修正方針**: function_name()を`scripts_lib/common.sh`に実装
**次回手順**:
1. function_name()の実装
2. 依存関係テスト
3. 統合テスト実行
```

#### **F-2. 原則の簡潔性維持機構**

**肥大化防止ルール**:

1. **新規原則追加時**: 既存原則3つを統合・削除検討
2. **例外ルール禁止**: 例外が必要な場合は原則自体を見直し
3. **定期レビュー**: 10個の原則追加ごとに全体最適化を実施

**原則優先度**:

1. セキュリティ > 一貫性 > 可読性 > 効率性
2. 命名規則 > 構造規則 > 実装規則

---

### 📋 G. 原則適用チェックリスト

**ファイル作成・修正時の必須確認項目**:

```markdown
- [ ] A-1: ファイル名が命名規則に準拠
- [ ] A-2: 全関数名が命名規則に準拠
- [ ] A-3: 全変数名が命名規則に準拠
- [ ] B-2: スクリプト標準構造テンプレートに準拠
- [ ] C-1: 共通関数が適切なライブラリに配置
- [ ] D-1: ライブラリ読み込みが統一パターンに準拠
- [ ] E-1: エラーハンドリングが標準テンプレートに準拠
```

**判断に迷った場合の対応**:

1. このチェックリストで不明な項目があるか確認
2. 該当する原則がない場合は「原則更新タスク」を作成
3. 原則更新後に作業を再開

---

### 🔧 H. 原則適用実例・修正パターン

#### **H-1. よくある原則違反とその修正方法**

---

## 🚨 セキュリティ絶対遵守事項

### 📛 SECRETS・APIキー・トークンの取り扱い

**2つの絶対ルール:**

1. **変数名は出す、データは出さない**
2. **統一記法: `VARIABLE_NAME=[SET:CONFIGURED]`**

```bash
# ❌ 絶対禁止 - データを出力
echo "GITHUB_TOKEN: $GITHUB_TOKEN"
echo "API_KEY: ${OPENAI_API_KEY}"

# ✅ 正しい方法 - 変数名は出す、データは出さない
echo "GITHUB_TOKEN=[SET:CONFIGURED]"
echo "OPENAI_API_KEY=[SET:CONFIGURED]"
echo "UCG_GITHUB_TOKEN=[SET:CONFIGURED]"

# ❌ 絶対禁止 - ログファイルにも同様
echo "Using token: $TOKEN" >> log.txt

# ✅ 正しい方法 - ログでも統一記法
echo "GITHUB_TOKEN=[SET:CONFIGURED]" >> log.txt
```

🚨 この指示に違反した場合は重大なセキュリティインシデント

---

**🎉 このファイル（AGENTS.md）の指示に従ってシステムの完全自動構築を実行してください。**
